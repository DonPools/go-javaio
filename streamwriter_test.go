package javaio

import (
	"bytes"
	"testing"

	"github.com/stretchr/testify/assert"
)

type List struct {
	Value int32
	Next  *List
}

func (*List) ClassName() string {
	return "List"
}

func (*List) SerialVersionUID() int64 {
	return 1
}

func TestWrite(t *testing.T) {
	list2 := &List{
		Value: 19,
	}
	list1 := &List{
		Value: 17,
		Next:  list2,
	}

	var buf bytes.Buffer
	w, err := NewStreamWriter(&buf)
	if err != nil {
		t.Error(err)
	}
	err = w.writeObject(list1)
	if err != nil {
		t.Error(err)
	}
	err = w.writeObject(list2)
	if err != nil {
		t.Error(err)
	}
	assert.Equal(t, []byte{
		0xac, 0xed, 0x00, 0x05, 0x73, 0x72, 0x00, 0x04, 0x4c, 0x69, 0x73, 0x74, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x01, 0x02, 0x00, 0x02, 0x49, 0x00, 0x05, 0x76, 0x61, 0x6c, 0x75, 0x65, 0x4c,
		0x00, 0x04, 0x6e, 0x65, 0x78, 0x74, 0x74, 0x00, 0x06, 0x4c, 0x4c, 0x69, 0x73, 0x74, 0x3b, 0x78,
		0x70, 0x00, 0x00, 0x00, 0x11, 0x73, 0x71, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x13, 0x70,
		0x71, 0x00, 0x7e, 0x00, 0x03,
	}, buf.Bytes())
}
